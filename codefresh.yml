version: '1.0'
steps:

  build_test:
    image: golang:1.10
    description: Run unit tests, build binaries, run acceptance tests...
    working_directory: /go/src/github.com/kubernetes-helm/chartmuseum
    commands:
      - ln -s /codefresh/volume/${{CF_REPO_NAME}} .
      - pwd && ls -la
      - ls -la /codefresh/volume/${{CF_REPO_NAME}}
      - make bootstrap test goviz build acceptance

  release:
    image: alpine:3.7
    description: Upload binaries, build and push Docker image...
    commands:
      - make release
    when:
      branch:
        only:
          - codefresh
